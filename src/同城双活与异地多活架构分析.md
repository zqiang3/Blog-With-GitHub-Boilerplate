---
layout: post
title: 多活架构分析
slug: live_architecture
date: 2021-07-16 16:24:47
status: publish
author: 君祁
categories:
  - architecture
tags:
  - architecture
excerpt: binary search
---

## 容灾经验分享
[浅谈异地多活及容灾经验分享](https://developer.aliyun.com/article/771429#:~:text=1%20%E4%BB%80%E4%B9%88%E6%98%AF%E5%BC%82%E5%9C%B0%E5%A4%9A,%E4%B8%AD%E5%BF%83%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%88%87%E6%8D%A2%E6%88%90%E5%8A%9F%E3%80%82)
异地多活，英文是Multi-Site High Availability，与传统灾备最主要的区别是“多活”里所有站点都是同时对外提供服务的。

传统的灾备方案缺点：
* 传统的灾备中心平时不提供服务，关键时刻无法确定切换到灾备中心是否可以切换成功。
* 传统的灾备中心平时不提供服务，整个灾备资源处于浪费状态，成本比较高。
* 传统的灾备中心平时不提供服务，平时提供服务的数据中心还停留在单地域，当业务体量大到一定程度时，这种模式无法解决单地域资源瓶颈的问题。

“异地多活”在2013年双十一取得了非常好的效果，于是这项技术在业务首次亮相。

### “多活”和“双活”有什么区别？
同样是“双活”，也会因为前面加了“同城”还是“异地”而有着本质的区别。如果是“异地双活”，就和“异地多活”仅存在站点数量上的差别，如果是同城双活，
与异地多活采用的是完全不同的技术。

同城双活，整个模式应用层是双活的

常见的多活手段，例如同城双活、两地三中心、三地五中心、异地多活架构设计方案并详述了各种方案的优缺点。

双机房距离近，通信质量好，底层储存例如mysql可以采用同步复制，有效保证双机房数据一致性。

[同城双活与异地多活架构分析](https://blog.csdn.net/vivo_tech/article/details/108552279)

## MySQL的半同步
默认情况下，MySQL采用异步复制，主库接收数据后给客户端返回成功，不管备库是否成功接收到数据。这种情况出现数据不一致的可能性就比较大。如果主库宕机，由从库恢复服务就会出现丢失数据的风险。
半同步模式，主库将binlog发给备库，备库写到relay-log后会给主库返回确认，这种情况牺牲部分性能提高了一致性。
完全同步模式，性能最差。