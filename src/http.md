---
layout: post
title: HTTP
slug: http
date: 2021-06-17 14:47:10
status: publish
author: 君祁
categories:
  - Maverick 
tags:
  - 网络
  - http
excerpt: HTTP
---

## HTTP2的特性
* 多路复用
* 头部压缩
* 服务器推送

多路复用允许单一的连接同时发起多重的请求-响应。
实现的原理是通过二进制分帧，HTTP/2将所有传输的信息分割为帧，并对它们采用二进制格式的编码。

**头部压缩的原理**

在HTTP/1中，请求和响应都是由状态行、请求/响应头部、消息主体三部分组成，一般消息主体都会经过gzip压缩，或者本身就是经过压缩后的二进制文件（图片、
音频），但状态行和头部却是以纯文本传输的，没有经过任何的压缩。

HTTP/2对头部数据也进行了压缩，并且在客户端和服务端之间：
* 维护一份相同的静态字典，包含常见的头部名称，以及特别常见的头部名称与值的组合。
* 维护一份相同的动态字典，可以动态地添加内容。
* 支持哈夫曼编码。

作用：

1. 对于完全匹配的头部键值对，例如method: GET，可以直接使用一个字符表示。
2. 对于头部名称可以匹配的键值对，例如cookie: xxx，可以将名称使用一个字符表示。
3. 对于不完全匹配静态字典的键值对，可以添加到动态字典中，在后续的请求中也可以使用一个字符表示了。
4. 对于在静态、动态字典中都不存在的内容，可以使用哈夫曼编码来减小体积。

## HTTP1.1的pipeline与HTTP/2的多路复用有什么区别？
网上有一张图，对HTTP1.1与HTTP/2在网络通信的差异进行了对比。

![](./images/httpconnection.png)

HTTP1.0使用的是短连接，每次请求响应完成会断开连接，效率非常低。

HTTP1.1增加了支持持久化连接，也就是长连接，在一个连接上可以进行多次请求/响应。但是多个请求/响应只能串行，后一个请求/响应只能在前一个请求/响应完成后才能发起。

HTTP1.1提供了管线化技术，可以将多个http请求打包在一起发给服务端，但是返回的响应也必须是按请求的顺序返回，如果某个请求耗时很长，就会阻塞后面的请求，有队头阻塞问题。

HTTP/2提出了多路复用技术，在一个tcp连接上可以并行多个请求/响应，不同请求/响应之间互不影响。原理是将消息分成多个二进制帧，二进制帧带有更多信息，标识自己属于哪个请求/响应，
这样多个请求/响应可以并行处理，不会相互阻塞。
