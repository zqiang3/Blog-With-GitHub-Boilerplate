---
layout: post
title: redis高可用
slug: redis_ha
date: 2021-06-24 01:00:23
status: publish
author: 君祁
categories:
  - Maverick
tags:
  - redis
  - ha
excerpt: redis高可用
---

## 过期删除策略
[链接](https://zhuanlan.zhihu.com/p/139423463)

* 定时删除，对内存友好，对cpu不友好
* 惰性删除，对cpu友好，对内存不友好
* 定期删除，折中

从服务器不会触发键过期，而是会等待主节点触发键过期。主节点键过期时，会同步del命令给所有的从节点。
从节点不处理过期键，但也不会返回已过期的数据，会通过独有的逻辑来标一个键已经过期。

## redis主从复制的过程
主节点开启一个子进程，生成rdb快照文件，同时将新的命令写到缓冲区
发送rdb快照文件
从机收到rdb文件后，加载数据到内存
主机再将缓冲区命令发到从机，从机加载后与主机达到一致状态
之后主机每收到一新写命令，都会同步给从机。

增量同步
条件：主机会维护一个复制积压缓冲区，如果从节缺失的数据在复制积压缓冲区内，可以执行增量同步，否则执行全量同步。